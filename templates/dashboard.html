{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Header del Dashboard -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1 fw-bold">Dashboard</h2>
        <p class="text-muted mb-0">Resumen general del sistema de reclutamiento</p>
    </div>
    <div>
        <button class="btn btn-outline-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download me-2" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
            </svg>
            Exportar
        </button>
    </div>
</div>

<!-- Tarjetas de Métricas -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 card-hover">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="text-muted mb-2 small text-uppercase fw-semibold">Candidatos</p>
                        <h2 class="mb-0 fw-bold">{{ total_candidatos }}</h2>
                        <p class="text-success mb-0 mt-2 small">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                            </svg>
                            +12% vs mes anterior
                        </p>
                    </div>
                    <div class="icon-box bg-primary bg-opacity-10 rounded-3 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-people text-primary" viewBox="0 0 16 16">
                            <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 card-hover">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="text-muted mb-2 small text-uppercase fw-semibold">Vacantes Activas</p>
                        <h2 class="mb-0 fw-bold">{{ vacantes_activas }}</h2>
                        <p class="text-info mb-0 mt-2 small">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-dash" viewBox="0 0 16 16">
                                <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/>
                            </svg>
                            Sin cambios
                        </p>
                    </div>
                    <div class="icon-box bg-success bg-opacity-10 rounded-3 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-briefcase text-success" viewBox="0 0 16 16">
                            <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5zm1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0zM1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 card-hover">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <p class="text-muted mb-2 small text-uppercase fw-semibold">En Proceso</p>
                        <h2 class="mb-0 fw-bold">{{ en_proceso }}</h2>
                        <p class="text-warning mb-0 mt-2 small">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                            </svg>
                            +8% esta semana
                        </p>
                    </div>
                    <div class="icon-box bg-warning bg-opacity-10 rounded-3 p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-hourglass-split text-warning" viewBox="0 0 16 16">
                            <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gráficas -->
<div class="row g-4 mt-2">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">Conversión por Fuente</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                                <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                            </svg>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Ver detalles</a></li>
                            <li><a class="dropdown-item" href="#">Exportar datos</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="chartConversionFuente" style="height: 320px;"></div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white border-0 py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">Ofertas Mensuales</h5>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                                <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                            </svg>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Ver detalles</a></li>
                            <li><a class="dropdown-item" href="#">Exportar datos</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div id="chartOfertasMensuales" style="height: 320px;"></div>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de Actividad Reciente -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="mb-0 fw-semibold">Actividad Reciente</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="border-0 py-3">Candidato</th>
                                <th class="border-0 py-3">Vacante</th>
                                <th class="border-0 py-3">Estado</th>
                                <th class="border-0 py-3">Fecha</th>
                                <th class="border-0 py-3">Acción</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle bg-primary bg-opacity-10 text-primary me-3">JD</div>
                                        <span class="fw-medium">Juan Pérez</span>
                                    </div>
                                </td>
                                <td class="py-3">Desarrollador Frontend</td>
                                <td class="py-3"><span class="badge bg-success-subtle text-success">Entrevista</span></td>
                                <td class="py-3 text-muted">Hace 2 horas</td>
                                <td class="py-3">
                                    <button class="btn btn-sm btn-outline-primary">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle bg-success bg-opacity-10 text-success me-3">MG</div>
                                        <span class="fw-medium">María González</span>
                                    </div>
                                </td>
                                <td class="py-3">Diseñadora UX/UI</td>
                                <td class="py-3"><span class="badge bg-warning-subtle text-warning">En Revisión</span></td>
                                <td class="py-3 text-muted">Hace 5 horas</td>
                                <td class="py-3">
                                    <button class="btn btn-sm btn-outline-primary">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td class="py-3">
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle bg-info bg-opacity-10 text-info me-3">CR</div>
                                        <span class="fw-medium">Carlos Rodríguez</span>
                                    </div>
                                </td>
                                <td class="py-3">Backend Developer</td>
                                <td class="py-3"><span class="badge bg-primary-subtle text-primary">Nuevo</span></td>
                                <td class="py-3 text-muted">Hace 1 día</td>
                                <td class="py-3">
                                    <button class="btn btn-sm btn-outline-primary">Ver</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card-hover {
        transition: all 0.3s ease;
    }
    
    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,0.1) !important;
    }
    
    .icon-box {
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
    }
    
    .table-responsive {
        border-radius: 0 0 0.375rem 0.375rem;
    }
    
    .badge {
        padding: 0.375rem 0.75rem;
        font-weight: 500;
        font-size: 0.75rem;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
// Configuración común para las gráficas
Highcharts.setOptions({
    colors: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#0dcaf0'],
    chart: {
        style: {
            fontFamily: 'inherit'
        }
    }
});

// Gráfica de conversión por fuente
fetch('/api/reporte/conversion-fuente')
    .then(response => response.json())
    .then(data => {
        Highcharts.chart('chartConversionFuente', {
            chart: { 
                type: 'column',
                backgroundColor: 'transparent'
            },
            title: { 
                text: '',
                style: { fontSize: '14px', fontWeight: '600' }
            },
            xAxis: { 
                categories: data.categorias,
                labels: { style: { fontSize: '12px' }}
            },
            yAxis: { 
                title: { text: 'Porcentaje (%)', style: { fontSize: '12px' }},
                labels: { style: { fontSize: '12px' }}
            },
            plotOptions: {
                column: {
                    borderRadius: 5,
                    dataLabels: {
                        enabled: true,
                        format: '{y}%'
                    }
                }
            },
            legend: {
                itemStyle: { fontSize: '12px' }
            },
            credits: { enabled: false },
            series: data.series
        });
    });

// Gráfica de ofertas mensuales
fetch('/api/reporte/ofertas-mensuales')
    .then(response => response.json())
    .then(data => {
        Highcharts.chart('chartOfertasMensuales', {
            chart: { 
                type: 'area',
                backgroundColor: 'transparent'
            },
            title: { 
                text: '',
                style: { fontSize: '14px', fontWeight: '600' }
            },
            xAxis: { 
                categories: data.meses,
                labels: { style: { fontSize: '12px' }}
            },
            yAxis: { 
                title: { text: 'Cantidad', style: { fontSize: '12px' }},
                labels: { style: { fontSize: '12px' }}
            },
            plotOptions: {
                area: {
                    fillOpacity: 0.2,
                    marker: {
                        radius: 4,
                        fillColor: '#FFFFFF',
                        lineWidth: 2,
                        lineColor: null
                    }
                }
            },
            legend: {
                itemStyle: { fontSize: '12px' }
            },
            credits: { enabled: false },
            series: data.series
        });
    });
</script>
{% endblock %}